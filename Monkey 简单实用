一，monkey概况：

monkey程序是Android系统自带的，其启动脚本是位于Android系统的/system/bin目录的monkey文件，其jar包是位于Android系统的/system/framework目录的monkey.jar文件。用户主要通过adb命令来启动monkey的，monkey在运行时，会根据命令行参数的配置，生成伪随机的事件流，并在Android设备上执行对应的测试时间。同时，monkey还会对测试系统进行监测，当出现以下三种情况的时候会进行特殊处理：

（1），如限定了monkey运行在特定包上，当监测到试图转到其它包的操作，将对其进行阻止。

（2），如应用程序崩溃或者接受任何失控异常，monkey将记录对应的错误日志，并根据命令行参数判断是停止还是继续运行。

（3），如果应用程序发生无响应的错误，monkey将记录对应的错误日志，并根据命令行参数判断是停止运行还是继续运行。

二，monkey参数：

monkey启动的命令行脚本为：

monkey [options]

其中，option表示monkey执行的可配置参数，是可选项（如果不指定options，monkey将以无反馈模式启动，并把时间任意发送到安装目录环境中的全部包）；count表示monkey执行的事件数，为必选项。

options可简单划分为5类：

·基本配置类参数

·事件类型和频率参数

·约束限制类参数

·调试类参数

·官方隐藏类参数

​Monkey基础类型参数：

Monkey的基础类型参数包括帮助参数和日志信息参数。帮助参数用于输出monkey命令使用指导；日志信息参数将日志分为3个级别，级别越高，日志的信息约详细。具体参数信息：

--help：输出monkey的命令行使用方法。

-v：表示反馈信息的级别，Monkey命令行中每增加一个-V参数，Monkey日志反馈信息的级别会对应增加一个level。​level0（缺省值）除了启动提示，测试完成和最终结果之外，提示较少信息。level（-v-v）提供较为详细的测试信息，如逐个发送activity的事件，level2（-v-v-v）提供更加详细的设置信息，如测试中被选中的或未被选中的activity等。举例：adb shell monkey -v-v 10

​​Monkey事件类型和频率参数：

monkey的事件类型参数的作用是对随机事件进行调控，从而使其遵照设定运行，如设置各种事件的百分比，设置事件生成使用的种子值等。频率参数主要限制事件执行的时间间隔。

-s ：伪随机数生成器的种子值。如果用相同的种子值再次运行monkey，他将生成相同的事件序列。举例：adb shell monkey -s 1111 -v 10

--throttle <毫秒数>：在事件之间插入固定延迟。通过这个选项可以减缓monkey的执行速度。如果不指定该选项，monkey将不会延迟，事件会尽可能快的被生成。

--pct-touch <百分比>：调整触摸事件的百分比（触摸事件是一个down-up事件，它发生在屏幕上的某单一位置）​

--pct-montion<百分比>​：调整动作事件的百分比（动作事件由屏幕上某处的一个down事件，一系列的伪随机事件和一个up事件组成）

--pct-pinchzoom<百分比>：调整二指缩放事件的百分比（二指缩放事件即智能机上的放大缩小手势操作）

--pct-rotation<百分比>：调整屏幕旋转事件的百分比（横屏和竖屏）

--pct-nav<百分比>：调整“基本”导航事件的百分比（导航事件由一个或者几个随机的移动组成，有时还伴随点击）

--pct-majornav<百分比>：​调整“主要“导航事件的百分比（这些导航事件通常引发图形界面中的动作，way键盘的中间按键，回退按键，菜单按键）

--pct-syskeys<百分比>：调整”系统按键事件的百分比“（这些按键通常被保留，由系统使用，如home，back，start call，end call及音量控制键）

--pct-appswitch<百分比>:调整调起activity的百分比（在随机间隔里，monkey通过调起startactivity方法最大限度的开启该package下的全部activity的一种方法）

--pct-flip<百分比>：调整键盘事件的百分比（键盘事件如点击输入框，键盘弹起，点击输入框以外区域，键盘收回等）

--pct-anyevent<百分比>：调整其他类型事件的百分比（包罗了所有其他类型的时间，如按键，其他不常用的设备按钮等）

​Monkey约束限制类参数：

monkey的约束限制类参数的作用是将随机事件运行的范围限制在一个或者多个包或者类中。

-p <包名>：如果用此参数指定了一个或者几个包，monkey将只允许启动这些包里面的activity。如果应用程序还需要访问其他包里的activity（如选择一个联系人），那些包也需要在此同时指定。如果不指定任何包，monkey将允许系统启动全部包里面的activity。要指定多个包，需要使用多个-p选项，每个-p选项只能用一个包。

-c<类别名>：如果用此参数指定一个或者几个类别，monkey将只允许系统启动被这些类别中的某个类别列出的activity。如果不指定任何类别，monkey将选择下列类别中列出的activity：Intent.CATEGORY_LAUNCHER或Intent.CATEGORY_MONKEY.要指定多个类别，需要使用多个-c选项。每个-c选项只能用于一个类别。

​Monkey调试类参数：

通过调试类命令，可以对monkey进行一些简单的调试，可以快速定位monkey执行过程中的一些问题。如果用户想监控应用程序所调用的包之间的转换，则可以用--dbg-no-events参数；如果用户想监控内存泄漏，可以用--hprof参数。

--dbg-no-events:设置此选项，monkey将执行初始化启动，进入一个测试activity，不会再进一步生成事件，为了得到最佳结果，把它与-v，一个或者多个包约束，以及一个保持monkey运行30秒或者更长事件的非零值联合起来，从而提供一个可以监视应用程序所调用的包之间的转换的环境。

--hprof:设置此选项，将在monkey事件执行之前和执行之后生成内存快照文件存放于手机的data/misc目录。通过对比执行前后的内存快照文件，可以协助定位内存泄漏问题。由于内存快照文件比较大，所以小心使用。

--ignore-crashes：通常，当应用程序崩溃发生任何失控异常时，monkey将停止运行。如果设备设置此选项，monkey将继续向系统发送事件，知道计数完成。

--ignore-timeouts：通常，当应用程序发生许可错误（如启动一个需要某些许可的activity）monkey将停止运行。如果设置了此选项，monkey将继续向系统发送事件，知道计数完成。

--ignore-sercurity-exceptions:通常，当应用程序发生许可错误（如启动一个需要某些许可的activity），monkey将停止运行。如果设置了此选项，monkey将继续向系统发送事件，直到计数完成。

--kill-process-after-error:通常，当monkey由于一个错误而停止时，出错的应用程序将继续处于运行状态。当设置了此选项时，将会通知系统停止发生错误的进程。

--monitor-native-crashes:监视并报告Android系统中本地代码的崩溃事件。

--wait-dbg:停止执行中的monkey，直到有调试器和它相连。

​Monkey官方隐藏类参数：

--pkg-blacklist-file<黑名单文件>：限制monkey不测试于指定黑名单文档中记录的包，若没有使用这个参数，monkey会测试系统内所有的包，若使用了这个参数，可通过在黑名单文档内记录所有不要测试的包名称，来限制monkey的执行范围，黑名单文档中每一行只能放一个包名。

--pkg-whitelist-file:限制monkey只测试于指定的白名单文档中记录的包，若没有使用这个参数，monkey会测试系统内所有的包。若使用了该参数，可通过在白名单文档内记录所有要测试的包名，来限制monkey的执行方位，白名单文档中每一行只能放一个包名。

Monkey事件：

Monkey所执行的随机事件流中包含11大主流事件，分别是触摸事件，手势事件，二指缩放事件，轨迹事件，屏幕旋转事件，基本导航事件，主要导航事件，系统按键事件，启动activity事件，键盘事件，其他类事件，monkey通过11大事件来模拟用户的常规操作，对其APP进行稳定性测试。​
